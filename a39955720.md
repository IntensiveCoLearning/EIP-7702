---
timezone: UTC+8
---

> 请在上边的 timezone 添加你的当地时区(UTC)，这会有助于你的打卡状态的自动化更新，如果没有添加，默认为北京时间 UTC+8 时区


# Denny

1. 自我介绍 大家好，我目前專注於 Solidity 智能合約的開發與審計，希望可以透過這次活動學習到更多相關知識。目前也正在尋找相關職缺，如果有相關機會，歡迎推薦給我！
2. 你认为你会完成本次残酷学习吗？ 一定可以
3. 你的联系方式（推荐 Telegram）Telegram:@a39955720

## Notes

<!-- Content_START -->

### 2025.05.14

## EIP-7702 是什麼？

EIP-7702 是一個新的提案，目的是讓傳統的 EOA 可以持久升級成像合約帳戶一樣，具備更多功能，比如一次完成多步操作、讓別人幫你付 gas，或是限制某個 key 只能做特定操作。

這是透過一種新的交易格式來做到的（type 0x04），交易裡會附帶一個「授權清單」，告訴鏈上：「這些帳戶現在起 delegate 給特定合約的 code，直到我再指定新的 code 或清空為止。」

---

## 跟 EIP-4337 和 EIP-6551 有什麼不同？

| 功能   | EIP-7702         | EIP-4337            | EIP-6551      |
| ---- | ---------------- | ------------------- | ------------- |
| 對象   | 普通錢包 (EOA)       | 完整合約錢包系統            | NFT 擴展錢包      |
| 特色   | 輕量、即插即用、不需額外基礎設施 | 架構完整，可完全替代 EOA      | 讓 NFT 擁有自己的錢包 |
| 複雜度  | 低                | 高，需要 EntryPoint 等配合 | 中             |
| 適合場景 | 想快速提升 EOA 體驗     | 長期帳戶抽象路線            | Web3 遊戲、身份系統等 |

---

## 核心功能介紹

### 1. Batching（多步操作一次完成）

像是先 approve、再 transfer，不用兩筆交易，EIP-7702 讓這變成一筆就能搞定。

### 2. Sponsorship（讓別人幫你出 gas）

你簽好交易內容後，可以請第三方幫你發送並支付 gas，他們甚至能用穩定幣或其他 token 向你收費。

### 3. Sub-permissions（權限分級）

你可以發出一把「權限受限」的子鑰匙，例如只能花 ERC20 但不能動 ETH，或設定一天最多只能花 1% 資產。

---

## 它怎麼運作？

* 當你發送 type 0x04 的交易時，你可以在裡面加一個授權清單。
* 每個授權項目會將指定帳戶的 code 設成特殊的「委派指標」，告訴 EVM：「這個帳戶的邏輯現在委派給另一個合約。」
* 執行像 CALL、DELEGATECALL 等指令時，會自動到被委派的合約中抓 code 來執行。

---

## 特別設計小細節

* **Code 不用自己寫**：只要給一個已部署合約的 address 就行，省空間、省 gas。
* **一次授權、多次使用**：7702 的授權設置是持久性的，不像 4337 要每次都包進 EntryPoint，7702 設完之後可以一直用。
* **可以自己贊助自己**：EOA 自己就能發這種交易，不需要別人幫你 relayer。

---

## Gas 成本

* 基礎成本與 EIP-2930 相似，再加上每個授權 tuple 先一次性收取最高可能成本 25000 gas。
* 如果授權帳戶原本非空，則會在執行中退回部分 gas，實際成本為 12500 gas；空帳戶則無退還，成本為完整 25000 gas。

---

## 安全提醒

* 被授權的 delegate contract 要小心撰寫，應具備 nonce、限額、目標合約白名單等 replay protection 機制，避免簽名被重放攻擊。
* 開發者應避免用 `require(tx.origin == msg.sender)` 這種方式做安全檢查，因為這提案可能會破壞這個邏輯。
* 若要變更授權合約，必須注意 storage collision 風險，建議使用 ERC-7201 標準管理 storage，或清空 storage 後再進行授權更換。

---

### 2025.05.15

昨天把 EIP-7702 的官方文檔讀過一遍，雖然大致理解設計理念，但還是有一些地方不是很清楚，所以決定自己整理一份自問自答。

---

**Q:** 為什麼要在授權清單裡加上 chain\_id？

**A:**
主要是為了**防止跨鏈重放攻擊**。chain\_id 就像是「這份授權只給這一條鏈用」，確保你在主網簽的授權，別人不能拿去測試網或其他鏈重放。要全鏈通用的話，chain\_id 可以設成 0。

---

**Q:** EIP-7702 的 y\_parity 到底是什麼？以前不是都用 v 嗎？

**A:**
`y_parity` 就是以前簽名裡那個 `v` 的「奇偶位」，本質上就是 `v` 去掉鏈 ID 之後剩下的那 1 bit。
0 代表偶數、1 代表奇數。新標準直接用 0 或 1，少了 27/28 或鏈 ID 這些混淆，比較直覺好用！

---

**Q:** 我想把一個普通錢包變成 7702 代理模式，流程大致怎麼走？

**A:**

1. 先準備好你要委派的合約 address。
2. 構造一個 type 0x04 的交易，填好授權清單。
3. 交易發上鏈，鏈上會把你的 EOA code 設定成「委派指標」，所有對你這個 EOA 的 CALL 都會去執行指定合約的邏輯。
4. 要恢復成純 EOA，只要再發一次授權為 0x0 的交易即可。

---

**Q:** 如果我委派到一個也在委派別人的合約，EVM 會怎麼辦？會不會死循環？

**A:**
EIP-7702 明確規定**只會追蹤第一層委派**，不會繼續往下找，這樣就不會出現委派 loop 或無限遞迴的 bug。
所以如果你指到另一個有 delegation indicator 的帳戶，EVM 只會拿第一個委派的 address 來執行，不會跳第二、三層。

---

### 2025.05.16

今天我做了一個利用 EIP-7702 來進行一筆同時 approve 和 transfer 的簡單 demo

GitHub Repository: [eip7702-demo](https://github.com/a39955720/eip7702-demo)

---

### 2025.05.17

## EIP-7702 可能的應用場景

### 1. 一次性多步驟操作（Batch Transactions）

* **說明**：傳統 EOA 用戶如果想在去中心化交易所（DEX）進行操作，往往需要先單獨批准（approve）代幣，再另外發送兌換（swap）等多筆交易，既耗時又費 gas。EIP-7702 允許用戶臨時將帳戶變成智慧合約，在一筆交易內自動完成「批准 + 兌換」、「跨多協議的資產搬移」等多步驟操作。
* **範例**：用戶只需一次簽名，就能將手上的 USDC 兌換成 ETH，並直接轉帳給另一個帳戶，省去重複簽名和多筆礦工費。
* **潛在影響**：大幅提升 DeFi 使用體驗，減少出錯風險，讓複雜操作更容易被主流用戶接受。

---

### 2. Gas 贊助（Gas Abstraction）

* **說明**：新用戶往往卡在「沒有 ETH 無法發送第一筆交易」這道門檻。EIP-7702 可讓 Dapp 或第三方臨時插入「由他人代付 Gas」的合約邏輯，用戶在不持有 ETH 的情況下也能順利上鏈互動。
* **範例**：遊戲、NFT 首次鑄造、空投活動等場合，用戶在網站操作時，Dapp 自動替用戶支付 Gas 費，讓 onboarding 流程更加順暢。
* **潛在影響**：降低 Web3 入口門檻，有助於用戶大規模成長。

---

### 3. 社交恢復（Social Recovery）

* **說明**：私鑰遺失是鏈上資產最大的風險。EIP-7702 支持臨時加載社交恢復邏輯（如多數好友簽名、家族成員共識），僅在恢復時需要，多數時間仍為一般帳戶。
* **範例**：用戶遺失私鑰時，只要指定的三位好友同時同意，就能臨時加載恢復邏輯，協助重設帳戶存取權。
* **潛在影響**：讓以太坊帳戶兼具自主管理與可靠的救援機制，降低資產永久丟失機率。

---

### 4. 交易權限控制（Transaction Policy）

* **說明**：EIP-7702 支持臨時加入各種資產管控邏輯，例如白名單、黑名單、多重簽章、多重驗證等，靈活限制帳戶資金流動或提現行為。
* **範例**：公司帳戶可設定大額轉帳需多位管理員同意，或者臨時限制對某些地址的付款，防止內部濫用或外部詐騙。
* **潛在影響**：提升機構、家庭、DAO 等多種場景的安全與資產管控彈性。

---

### 5. 隱私交易與混幣（Privacy/Mixing）

* **說明**：EIP-7702 可臨時加載隱私協議邏輯，執行如 zk-SNARK、混幣、跳板合約等操作，強化資金隱私。
* **範例**：臨時將資金經由混幣協議轉到新地址，或一次性使用零知識證明隱藏交易路徑。
* **潛在影響**：滿足高端用戶與機構對隱私的需求，同時避免永久性複雜設定。

---

### 6. 自定義簽章驗證（Custom Signature Validation）

* **說明**：EIP-7702 可讓帳戶臨時切換到多因素認證（2FA）、生物識別驗證、硬體錢包驗證等進階簽章邏輯，針對大額或高風險操作加強安全。
* **範例**：用戶進行高額轉帳時，錢包自動要求手機 App 二次驗證或生物辨識，普通日常操作則無需額外手續。
* **潛在影響**：大幅提升大戶、機構或重視安全用戶的資產保障層級。

---

### 2025.05.18

![image](https://github.com/user-attachments/assets/2e388bef-f65b-473e-b8e1-733c7ef074b2)


## EIP-7702 流程與原理圖解筆記

### 1. 帳戶創建與簽名

* 用戶用錢包 App 創建帳戶（EOA），拿到 `address` 和 `private key`。
* 透過私鑰簽名，構造一筆 type-4（Set code transaction）交易。

### 2. 授權清單（authorization list）

* 交易裡包含一個授權清單，指定：

  * `chain_ID`：僅適用於特定鏈
  * `address`：要代理的合約地址（填 0x0 代表清除委派）
  * `nonce`：防止重放
  * `signature`：對這些資料的簽名

### 3. 交易提交與上鏈

* 用戶可選擇自己或交給第三方贊助者（someone with gas）送出交易。
* 交易被送進節點（node）並正式寫進鏈上。

### 4. 帳戶狀態變化

* 一般 EOA 的 address 沒有 code。
* type-4 交易執行後，該 address 的 code 會變成 `0xef100<address>`（特殊前綴 + 被代理合約地址）。
* 這表示之後所有對這個 address 的 call，實際都會代理執行指定的合約 code。

### 5. 代理行為與影響

* 只要被設為代理，這個 EOA 就像 smart contract wallet 一樣，能跑多步操作、批次執行。
* 呼叫如 CALL、DELEGATECALL、STATICCALL 都會進到代理合約邏輯。
* 但像 EXTCODESIZE 這種讀 code 長度的操作，只會看到前綴本身。

### 6. 安全與升級注意

* 被代理的 code 誰能控制？能否升級？有安全審查嗎？
* 用戶如果要更換委派合約，只需再發一次 type-4 交易，address 設為 0x0 就能清除。
* 用戶需了解委派合約功能及風險，避免授權給惡意合約。

#### 來源

[https://www.youtube.com/watch?v=ZFN2bYt9gNE](https://www.youtube.com/watch?v=ZFN2bYt9gNE)

---

### 2025.05.19

## ERC-4337（帳戶抽象）重點筆記

最近剛看完 EIP-7702，今天換來複習一下帳戶抽象（ERC-4337）。這個提案其實是目前智能合約錢包的主流實現，整理一些關鍵內容跟自己做個對比筆記：

### 什麼是帳戶抽象（ERC-4337）？

帳戶抽象讓用戶直接用「智能合約錢包」作為主帳戶，帳戶驗證、權限和 Gas 支付邏輯都能自訂，不再受限於傳統 EOA。
**無需更改主網協議，已在以太坊主網運作。**

---

### 核心流程與組件

1. **UserOperation**：
   用戶構造一個特殊的「操作請求」（可多步操作），發送到 ERC-4337 專屬 mempool。

2. **Bundler**：
   節點監控 UserOperation，將多個操作打包成一筆交易，提交到 EntryPoint 合約。

3. **EntryPoint 合約**：
   驗證並執行所有 UserOperation，處理交易與費用。

4. **Paymaster**：
   合約可為用戶贊助 Gas，也可用 ERC20 代幣付費，降低新手上手門檻。

5. **Aggregator**：
   多重簽名聚合驗證，降低 callData 成本。

---

### 和傳統 EOA 差異

| 特性     | ERC-4337 合約帳戶 | 傳統 EOA    |
| ------ | ------------- | --------- |
| 驗證方式   | 可自訂（多簽、2FA等）  | 單純私鑰簽名    |
| Gas 支付 | 可由第三方或代幣支付    | 必須自己付 ETH |
| 批次操作   | 一筆 UserOp 可多步 | 一次只能一個操作  |
| 發送方式   | Bundler 打包後上鏈 | 直接廣播到鏈上   |

---

### 實際應用

* 批次交易（比如一鍵 approve + swap）
* 免 ETH onboarding（Dapp 幫你付 Gas）
* 社交恢復、多簽、多重驗證安全加強
* 支援 USDC、USDT 等多種代幣支付手續費

---

### 與 EIP-7702 的最大區別

|      | ERC-4337             | EIP-7702         |
| ---- | -------------------- | ---------------- |
| 目標   | 直接推廣合約錢包             | 讓 EOA 具備代理/批次能力  |
| 運作方式 | 需 Bundler、EntryPoint | 原生鏈上支援 type-4 交易 |
| 用戶體驗 | 彈性最高                 | 過渡型方案、兼容 EOA 環境  |

---

**參考連結**：

* [Alchemy 原文](https://www.alchemy.com/overviews/what-is-account-abstraction)
* [LearnBlockChain 中文](https://learnblockchain.cn/article/5946)

---

### 2025.05.20

## EIP-7702 的現實挑戰與新標準協作

### 1. 為什麼用戶不愛換智能帳戶？

* 換帳戶要部署新合約、搬資產、學新介面、要有 ETH 付部署費，流程繁瑣。
* 地址一換，交易紀錄、NFT、POAP 都割裂，身份分散、連到 Dapp 的授權要重來。
* EOA 私鑰在各錢包通用，智能帳戶實作各異，跨錢包與跨鏈遷移困難。

---

### 2. 生態碎片化與錢包主導

* 各家錢包可自訂 EIP-7702 實作（不同合約、授權機制），未來生態會更碎片化。
* **應用（Dapp）不能直接設定 EIP-7702 授權**，必須透過錢包，由用戶選擇是否升級。
* 嵌入式錢包（如 Privy, Magic 等）可自訂授權方案，但也多半有預設合約實作。

---

### 3. 開發者要面對的新挑戰

* 未來不只 EIP-7702，還會有 ERC-7710/7715/5792 等新標準並存，要因應多種錢包支援方式。
* **Companion Account（伴生帳戶）**：每個 Dapp 可部署專屬智能帳戶幫用戶處理批量、限權、資產管理等高階操作，彈性最大。
* 工具如 Biconomy AbstractJS 可協助開發者處理多標準、錢包支援偵測與批次交易封裝，降低碎片化複雜度。

---

### 4. 新標準重點說明

#### ERC-7710

* 標準化智能合約之間的授權接口，讓帳戶能指定其他合約（如伴生帳戶）獲得特定操作權限，超越僅限 ERC20 的 approve 概念。

#### ERC-7715

* 增加 `wallet_grantPermissions` 方法，應用可請求錢包開放操作權限，由用戶確認授權，提升互動性與細緻權限管理。

#### ERC-5792

* 提供 `wallet_sendCalls` API，允許應用一次發送多筆合約呼叫，由錢包整合成單次簽名，簡化用戶一鍵多步操作（如批量 NFT 發送、approve+swap）。

---

### 5. 總結

* **EIP-7702 提供 EOA 智能升級方案，降低用戶換帳戶門檻，但功能主導權在錢包商。**
* **開發者需適應多標準、碎片化、伴生帳戶設計，並運用新標準 ERC-7710/7715/5792 進行高級功能協作。**
* 未來區塊鏈用戶體驗將更友好，但錢包生態會有一段陣痛與標準並存的適應期。

---

**參考連結**：

* [A Comprehensive EIP-7702 Guide for Apps](https://blog.biconomy.io/a-comprehensive-eip-7702-guide-for-apps/)

---

<!-- Content_END -->
